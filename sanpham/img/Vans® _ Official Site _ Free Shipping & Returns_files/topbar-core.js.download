define(["jquery","jquery.hoverintent","wcs.topbar-helper","jquery-mobile-events","pubsub","shared.main.screen"],function(t,e,s,n,o,a){function i(t,e){this.element=t,this.options=e,this.metadata=d(this.element).data("topbar-options")}var d,r;d=jQuery,window,document,r="topbarCore",i.prototype={defaults:{hoverDelay:[WCS_CONFIG.get("topnav::navHoverDelay"),WCS_CONFIG.get("topnav::navHoverDelay")],spaceBetweenLogoAndNav:30,tappable:!1},init:function(){var t=this;return t.config=d.extend({},t.defaults,t.options,t.metadata),t.config.currentScreenSize=a.size(),t.findElements(),t._build(),t.drawMenu(),0<d("> .has-dropdown-js:hover",t.$topbarLower).length&&t.openDropdown(d("> .has-dropdown-js:hover",t.$topbarLower)),t.events(),this.initSmallCartButton(),this.initPromoCarousel(),this.initTopbarUtil(),t},_build:function(){this.removeBackArrows(),this.initStackedList()},findElements:function(){this.$masterHeader=d(this.element),this.$topbar=this.$masterHeader.find(".top-bar-js, .top-bar-acord-js"),this.$titleArea=this.$topbar.find(".title-area"),this.$topbarLower=this.$topbar.find(".lower"),this.$topbarLowerContainer=this.$topbar.find(".lower-container-js"),this.$backButton=this.$topbar.find(".title.back"),this.$moreLinksContainer=this.$topbarLower.find(".more-links-container-js"),this.$moreLink=this.$topbarLower.find(".gnav-more"),this.$searchForm=this.$masterHeader.find(".search-form-container .search-input-container"),this.$searchButton=this.$masterHeader.find(".search-form-container .postfix.search-button")},drawLargeMenu:function(){this.setNavigationItems(),this.enableCustomStyleForAll(),this.enableCustomStyleForMoreLink(),this.$moreLinksContainer.find(".more-link-js").length&&this.calculateMoreContainerWidth(this.$moreLinksContainer)},drawSmallMenu:function(){this.disableCustomStyle(),this.resetNavigationItems(),this.hideMoreMenu()},hideMoreMenu:function(){this.$moreLink.addClass("hide")},removeBackArrows:function(){!0===WCS_CONFIG.get("topnav::dropdownBackButtonNoArrow")&&this.$backButton.each(function(){var t=d(this);t.html(t.html().replace(/\Â« /g,""))})},initStackedList:function(){var i,a;!0===WCS_CONFIG.get("topnav::dropdownStackedList")&&(a=!0===WCS_CONFIG.get("topnav::dropdownStackedListConfigEnabled")?(i="data-sub-cat-col-row","data-sub-cat-col-container"):(i="id","data-sub-cat-id"),this.$topbarLower.find("> .has-dropdown-js").each(function(){var o=d(this).find(".sub-cat-lists-js");$stackedLists=o.find(".stacked-list-js"),$stackedLists.each(function(){var t=d(this),e=t.attr(i),n=t.clone().children().addClass("stacked-list show-for-medium");o.find("["+a+'="'+e+'"]').append(n)})}))},getMoreLinkWidth:function(){var t,e=this,n=e.$moreLink.hasClass("hide");return e.$moreLink.removeClass("hide"),t=s.outerWidthFix(e.$moreLink),n&&e.$moreLink.addClass("hide"),t},getSearchWidth:function(){var t=this,e=0;return!0===WCS_CONFIG.get("topnav::navHeaderExcludeSearch")||(!0===t.$searchForm.is(":visible")&&(e+=s.outerWidthFix(t.$searchForm)),!0===t.$searchButton.is(":visible")&&(e+=s.outerWidthFix(t.$searchButton))),e},getLogoWidth:function(){var t=0,e=a.size();if("small"===e||"medium"===e){if(!0===WCS_CONFIG.get("topnav::navHeaderLogoSeparateLineTabletEnabled"))return t}else if(!0===WCS_CONFIG.get("topnav::navHeaderLogoSeparateLineDesktopEnabled"))return t;return!0===this.$titleArea.is(":visible")&&(t+=s.outerWidthFix(this.$titleArea)),t+=this.config.spaceBetweenLogoAndNav},getMaxNavWidth:function(){var t=this,e=t.$topbar.width(),n=t.$topbarLowerContainer.width();return e-=t.getLogoWidth(),e-=t.getSearchWidth(),e=Math.min(e,n)},getAvailableNavWidth:function(t){var e=t||this.getMaxNavWidth();return this.$topbarLower.find("> li:not(.more-link-js)").each(function(){e-=s.outerWidthFix(d(this))}),e},hideMenuItem:function(t){return t.removeClass("visible-nav-item").addClass("hidden-nav-item"),t},showMenuItem:function(t){return t.removeClass("hidden-nav-item").addClass("visible-nav-item"),t},setNavigationItems:function(){var i=this,t=i.$topbarLower.find("> li.more-link-js"),a=[];i.emptyMoreLinkContents(),i.$moreLink.removeClass("hide"),t.each(function(){var t=d(this);return a.push(s.outerWidthFix(t)),a}),t.each(function(){var t=d(this);i.hideMenuItem(t)});var e=i.getMoreLinkWidth(),n=i.getMaxNavWidth(),r=i.getAvailableNavWidth(n);t.each(function(t,e){var n=d(this),o=a[t];if(!(o<=r))return!1;i.showMenuItem(n),r-=o});var o=i.$topbarLower.find(".hidden-nav-item");1==o.length&&a.slice(-1)[0]<=r+e&&(i.showMenuItem(o),i.$moreLink.addClass("hide"));o.length<=0&&i.$moreLink.addClass("hide"),i.$topbarLower.find(".visible-nav-item").each(function(){i.refreshItemsInMainNav(d(this))}),i.$topbarLower.find(".hidden-nav-item").each(function(){i.refreshItemsInMoreNav(d(this))}),i.$topbarLowerContainer.css({overflow:"visible"}),i.$topbarLower.css({"max-width":n,"min-width":0,width:"auto"})},emptyMoreLinkContents:function(){!0===WCS_CONFIG.get("topnav::navHeaderIncludeDropdownsInMore")&&this.$moreLinksContainer.empty()},refreshItemsInMainNav:function(t){var e=t.text();this.$moreLinksContainer.find(".more-link-js").filter(function(){d(this).text()===e&&d(this).remove()}),this.toggleMoreLinksDropdown()},refreshItemsInMoreNav:function(t){var e=t.clone(),n=!1,o=t.text();this.$moreLinksContainer.find(".more-link-js").filter(function(){d(this).text()===o&&(n=!0)}),n||"small"===a.size()||e.prependTo(this.$moreLinksContainer),this.toggleMoreLinksDropdown()},toggleMoreLinksDropdown:function(){!0===WCS_CONFIG.get("topnav::navHeaderExcludeMore")&&(this.$moreLinksContainer.find(".more-link-js").length?(this.$moreLink.removeClass("hide"),this.calculateMoreContainerWidth(this.$moreLinksContainer)):this.$moreLink.addClass("hide"))},calculateMoreContainerWidth:function(t){if(!0===WCS_CONFIG.get("topnav::navHeaderExcludeMore")){var a=0,e=2*parseInt(t.css("padding"));t.find(".more-link-js").each(function(){var t=d(this),e=d(".sub-category",t),n=parseInt(e.css("min-width")),o=e.outerWidth(),i=Math.max(n,o);t.css("width",i),a+=i}),a+=e,t.css("width",a)}},resetNavigationItems:function(){this.$topbarLower.css({"min-width":"","max-width":"",width:""})},events:function(){var n=this,t=d("> .has-dropdown-js",n.$topbarLower),e=d("> a:not(.has-dropdown .has-dropdown > a)",t),o=d(".more-links-container-js .more-link-js > a"),i=d("#utilitynav-signin");o.on("click",function(t){var e=d(this).attr("href");d(location).attr("href",e)}),i.on("open.zf.reveal",function(){n.$topbar.hasClass("expanded")&&"small"!==a.size()&&n.setNavigationItems()}),e.on("touchend",function(t){var e=d(this);n.config.tappable=!0,"small"!==a.size()&&(t.preventDefault(),t.stopPropagation(),n.simulateHover(e.parent()))}),t.hoverIntent({over:function(t){var e=d(this);"small"!==a.size()&&(n.config.tappable||n.openDropdown(e))},out:function(t){var e=d(this);"small"!==a.size()&&(n.config.tappable||n.closeDropdown(e))},timeout:n.config.hoverDelay}),n.disableDoubleClicks(),d.pubsub("subscribe","window.resize",function(t,e){e&&e.now&&(n.config.currentScreenSize=e.now,n.drawMenu()),"small"!==n.config.currentScreenSize&&n.setNavigationItems()})},drawMenu:function(){var t=this;d("> .has-dropdown-js",t.$topbarLower).each(function(){t.closeDropdown(d(this))}),"small"===t.config.currentScreenSize?t.drawSmallMenu():t.drawLargeMenu(),t.resetDropdown()},simulateHover:function(t){t.hasClass("hover")?this.closeDropdown(t):this.openDropdown(t)},enableCustomStyleForAll:function(){var t=this;this.$topbarLower.find("> .has-dropdown-js:not(.gnav-more)").each(function(){t.enableCustomStyle(d(this))})},enableCustomStyle:function(t){var e;e=!0===WCS_CONFIG.get("topnav::navHeaderIncludeDropdownsInMore")?".dropdown:not(.mini-list)":".dropdown",t.children(e).addClass("dropdown-custom-style").find(".has-dropdown-js").addClass("mega").end().find(".has-dropdown-js").removeClass("has-dropdown-js").end().find(".dropdown").addClass("mega2").end().find(".dropdown").removeClass("dropdown"),d(".moved").removeClass("moved")},enableCustomStyleForMoreLink:function(){if(!(this.$moreLink.length<1||this.$moreLinksContainer.length<1)){var t=this.$moreLink[0].getBoundingClientRect().right,e=this.$moreLinksContainer.outerWidth();t<e?this.$moreLinksContainer.css("right",t-e+"px"):this.$moreLinksContainer.css("right","")}},disableCustomStyle:function(){var t=this.$topbarLower.find("> .has-dropdown-js").children(".dropdown");t.find(".mega").addClass("has-dropdown-js"),t.find(".mega").removeClass("mega"),t.find(".mega2").addClass("dropdown"),t.find(".mega2").removeClass("mega2"),t.removeClass("dropdown-custom-style"),t.css("cssText","")},setGroupHeight:function(t,e,n){var o,i,a=[];if(i=null!==e||""!==e?e:null,t.not(i).each(function(){a.push(d(this).height())}),"max"==n){var r=Math.max.apply(Math,a);o=0<r?r+"px":""}else"inherit"==n&&(o="");t.not(i).each(function(){d(this).height(o)})},openDropdown:function(t){var e=this;t.siblings(".has-dropdown-js").each(function(){var t=d(this);e.closeDropdown(t)}),!0===WCS_CONFIG.get("topnav::dropdownStackedList")&&d("ul.dropdown",t).hasClass("stacked")&&e.setGroupHeight(d(".sub-cat-lists-js > li",t),".stacked-list-js","max");var n=d("body").outerWidth(),o=-t.offset().left;t.hasClass("has-dropdown-custom-js")||t.children(".dropdown:not(.mini-list)").css({width:n+"px",left:o+"px",top:this.$topbarLower.outerHeight()+"px"}),t.data("is-dropdown-shown")||(t.find(".dropdown, .dropdown-arrow").show(0),t.data("is-dropdown-shown",!0),t.addClass("hover"),e.lazyloadDropdown(t))},resetDropdown:function(){this.$topbarLower.find(".dropdown, .dropdown-arrow",".has-dropdown-js").css("display","")},closeDropdown:function(t){t.removeClass("hover"),t.data("is-dropdown-shown")&&(t.find(".dropdown, .dropdown-arrow").hide(0),t.data("is-dropdown-shown",!1))},lazyloadDropdown:function(t){t.find("img.lazy").each(function(){var t=d(this);t.attr("src",t.data("original"))})},initPromoCarousel:function(){var e=d("#espot-header");0<e.length&&require(["wcs.promo-carousel"],function(t){e.promoCarousel()})},disableDoubleClicks:function(){this.$topbarLower.on("click",function(t){var e=d(this);if(e.hasClass("js-state-processing"))return t.preventDefault(),void t.stopImmediatePropagation();e.addClass("js-state-processing"),setTimeout(function(){e.removeClass("js-state-processing")},600)})},initTopbarUtil:function(){var e=d(".topnav-util-js");0<e.length&&require(["wcs.topbar-util"],function(t){e.topbarUtility()})},initSmallCartButton:function(){0<d(".cart-topbar-js").length&&require(["wcs.topbar-smallscreen-cart"],function(t){d(".cart-topbar-js").topbarSmallCart()})}},i.defaults=i.prototype.defaults,d.fn.topbarCore=function(e){return this.each(function(){var t=d(this).data(r);t||(t=new i(this,e).init(),d(this).data(r,t))})}});
//# sourceMappingURL=../../../maps/js/wcs/topbar/topbar-core.hash-4c2ebfc7440873077bb86615c8d52779.js.map