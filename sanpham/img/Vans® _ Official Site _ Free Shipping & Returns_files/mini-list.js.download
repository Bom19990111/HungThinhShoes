define(["jquery","pubsub","wcs.alert","promise!wcs.zmetrics","datalayer.wcs.mini-list","coremetrics.wcs.mini-list","promise!wcs.lang-msg"],function(H,t,i){var o=!1,m=!1,n=!1,h=0,f=0,N=WCS_CONFIG.get("global::miniCartLocation"),c=0<H(".topnav-header").length||"top"===N;H(".topnav-minicart-panel, .global-cart-wishlist-panels-js");function P(){c?i.showLoadingNotification("p"):"right"===N&&i.showLoadingNotificationByPosition("l",".global-cart-wishlist-panels-js")}function T(){c?i.hideLoadingNotification():"right"===N&&i.hideLoadingNotificationByPosition(".global-cart-wishlist-panels-js")}function e(t){var i,e,a,n,r,s=H(t.target);if("delete"===s.data("action")||"add to cart"===s.data("action")){t.preventDefault();var c=s.parents(".cart-list"),o={title:c.find(".page-title").text(),page:c.data("tabcontent"),container:c},d="add to cart"===s.data("action")?LANG_MSG["DEFAULT_MINICART.MSG.movedToShoppingCart"]:void 0,l=s.parents(".cart-item-js").find(".cart-item-row"),m="";l.find(".item-attr-js.defining").each(function(){m+=(0<m.length?" / ":"")+H(this).text()});var h=l.find(".product-info-js").data("seoCategory"),f=l.find(".product-info-js").data("bundlePartnumber"),u=l.find(".product-info-js").data("itemPartnumber"),p=l.find(".product-info-js").data("masterCategory"),g=l.find(".product-info-js").data("parentProductId"),v=l.find(".product-info-js").data("childProductId"),b=l.find(".product-info-js").data("partNumber"),j=l.find(".product-info-js").data("styleCode"),C=l.find(".item-attr-info-js").data("colorCode"),I=l.find(".item-attr-info-js").data("colorDescription"),w=l.find(".item-attr-info-js").data("size"),y=l.find(".item-price-js").data("unitPrice"),x={currency:WCS_CONFIG.get("global::currencyCode"),productName:l.find(".item-name-js").text().replace(/^\s+|\s+$/gm,""),productId:b||"",unitPrice:y||"",definingAttributes:H.trim(m),quantity:l.find(".item-qty-js").data("qty"),categoryId:"",masterCategoryId:p||"",childPartNumber:u||"",parentProductId:g||"",childProductId:v||"",bundlePartNumber:f||"",seoCategory:h||"",isQuickView:!1,isSearch:!1,styleCode:j||"",colorCode:C||"",colorDescription:I||"",size:w||""};i=s.attr("href"),e=o,a=d,n=s.data("action"),r=x,n=n||"remove",P(),H.ajax({url:i,type:"POST",dataType:"html",success:function(t){"wishlist"===e.page?(_(t,e,a,n),H.pubsub("publish","WISHLIST_UPDATED.remove",data={product:[{bundleId:r.bundlePartNumber,itemId:r.childPartNumber,name:r.productName,productId:r.productId}]}),"add to cart"===n&&(0<H(".shopcart-js").length&&(window.location.href=H(".btn-shoppingbag-js").attr("href")),orderId&&H.pubsub("publish","vfdp.wcs.mini_list.add_to_cart_succeeded",r))):"shopcart"===e.page&&"delete"===n&&orderId&&"right"===N&&_(t,e,a,n);var i="delete"==n||"remove"==n?"remove":"add";H.pubsub("publish","SHOPCART_UPDATED."+i,{product:[{bundleId:r.bundlePartNumber,itemId:r.childPartNumber,name:r.productName,productId:r.productId}],rewardEligibility:{orderId:orderId,rewardOptionEligible:rewardOptionEligible,rewardsAdded:rewardsAdded},action:n})}}).always(function(t){T()}),"add to cart"===s.data("action")&&(H.pubsub("publish","vfdp.wcs.mini_list.add_to_cart_clicked"),zm.trackAddedItem(x))}}function _(t,i,e,a){function c(t){var i=t.css("top")||"auto";return"auto"==i&&(i="0px"),parseFloat(i.replace(/[^-\d\.]/g,""))}function n(t){var i=H(t.target);if(i.hasClass("cart-item-container-js")||0<i.parents(".cart-item-container-js").length){var e=-t.originalEvent.deltaY,a=Math.max(-1,Math.min(1,e));return a<0?l.container.find(".cart-item-nav.next").hasClass("hide")||l.container.find(".cart-item-nav.next").hasClass("disabled")||l.container.find(".cart-item-nav.next").trigger("click"):0<a&&(l.container.find(".cart-item-nav.prev").hasClass("hide")||l.container.find(".cart-item-nav.prev").hasClass("disabled")||l.container.find(".cart-item-nav.prev").trigger("click")),!1}return!0}var l;i.container.html(t),"add to cart"===a&&i.container.find(".ajax-messaging").html('<p class="message success">'+e+"</p>"),r(l=i),l.container.find(".cart-item-nav.prev").on("click",function(){if(!H(this).hasClass("ready"))return!1;if(H(this).hasClass("disabled"))return!1;var t=c(H(this).closest(".cart-list").find(".cart-item-slide-js")),i=H(this).closest(".cart-list").find(".cart-item").outerHeight(!0);H(this).removeClass("ready"),H(this).closest(".cart-list").find(".cart-item-nav.next").removeClass("disabled"),H(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"+="+Math.min(-t,i)},300,function(){H(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("ready"),0<=c(H(this).closest(".cart-list").find(".cart-item-slide-js"))&&H(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("disabled")})}),l.container.find(".cart-item-nav.next").on("click",function(){if(!H(this).hasClass("ready"))return!1;var t,i=l.container.find(".cart-item-slide-js").outerHeight(!1),e=l.container.find(".cart-item-container-js").outerHeight(!0),a=c(H(this).closest(".cart-list").find(".cart-item-slide-js")),n=H(this).closest(".cart-list").find(".cart-item-js").outerHeight(!0);if(i+parseInt(a)<=e)return!1;newTop=i+parseInt(a)-n,t=newTop<=e?n-(e-newTop):n,H(this).removeClass("ready"),H(this).closest(".cart-list").find(".cart-item-nav.prev").removeClass("disabled"),H(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"-="+t},300,function(){H(this).closest(".cart-list").find(".cart-item-nav.next").addClass("ready");var t=l.container.find(".cart-item-slide-js").outerHeight(!0),i=l.container.find(".cart-item-container-js").outerHeight(!0),e=c(H(this).closest(".cart-list").find(".cart-item-slide-js"));t+parseInt(e)<=i&&H(this).closest(".cart-list").find(".cart-item-nav.next").addClass("disabled")})}),l.container.find(".cart-item-container-js").on({wheel:n,touchstart:function(t){var i=H(this).closest(".cart-list").find(".cart-item-slide-js");i.stop(),o=!0,h=t.originalEvent.touches[0].clientY,f=c(i)},touchmove:function(t){m=!0,t.preventDefault();var i=H(this).closest(".cart-list").find(".cart-item-slide-js"),e=H(this).closest(".cart-list").find(".cart-item-container-js"),a=i.outerHeight(!0),n=e.outerHeight(!0),r=t.originalEvent.touches[0].clientY-h,s=f+r,c=Math.min(0,n-a),o=l.container.find(".cart-item-nav.prev"),d=l.container.find(".cart-item-nav.next");s<0&&c<s?(i.css("top",s+"px"),o.hasClass("disabled")&&o.removeClass("disabled"),d.hasClass("disabled")&&d.removeClass("disabled")):0<=s?(i.css("top",s/2+"px"),o.hasClass("disabled")||o.addClass("disabled")):s<=c&&(i.css("top",s/2+c/2+"px"),d.hasClass("disabled")||d.addClass("disabled"))},touchend:function(t){if(o&&m){var i=H(this).closest(".cart-list").find(".cart-item-slide-js"),e=H(this).closest(".cart-list").find(".cart-item-container-js"),a=i.outerHeight(!0),n=e.outerHeight(!0),r=n-a,s=c(i);0<s||0<n-a?i.animate({top:"0px"},400):s<n-a&&i.animate({top:r+"px"},400)}m=o=!1,h=t.originalEvent.changedTouches[0].clientY}}),l.container.on({touchmove:function(t){t.preventDefault()}}),H(document).on("mousewheel",n),H(window).on("resize",function(){r(l);var t=l.container.find(".cart-item-slide-js").outerHeight(!0),i=d(l),e=c(l.container.find(".cart-item-slide-js"));t+parseInt(e)<i-50?l.container.find(".cart-item-nav.next").addClass("disabled"):l.container.find(".cart-item-nav.next").removeClass("disabled")}),H.pubsub("publish","MINICART_CONTENT_RENDER_COMPLETE",e)}function d(t){var i=t.container.height(),e=0,a=t.container.find(".content-head"),n=parseInt(a.css("margin-top"),10),r=parseInt(a.css("margin-bottom"),10),s=a.find(".section-title"),c=parseInt(s.css("margin-top"),10),o=s.outerHeight(!1),d=a.find(".page-title"),l=parseInt(d.css("margin-top"),10),m=d.outerHeight(!1),h=t.container.find(".cart-actions, .wishlist-actions").outerHeight(!0),f=0,u=0,p=0,g=t.container.find(".waved-line-sep"),v=parseInt(g.css("margin-top"),10),b=g.outerHeight(!0),j=Math.max(n,c);e=j+o+l+m+r,e=Math.max(j+r,e);var C=t.container.find(".free-shipping-promo"),I=t.container.find(".mini-cart-promo-header");return 0<C.length?(f=parseInt(C.css("margin-top"),10),u=C.outerHeight(!1),p=parseInt(C.css("margin-bottom"),10)):0<I.length&&I.each(function(){var t=H(this);if(0<t.parents(".cart-item-container-js").length)return!1;f=parseInt(t.css("margin-top"),10),u=parseInt(t.parents(".espot-container").outerHeight(!1)),p=parseInt(t.parents(".espot-container").find("p").css("margin-bottom"),10)}),i-e-h-b-(u=f+u+p)+Math.min(p,v)}function r(t){var i=t.container.find(".cart-item-slide-js").outerHeight(!0),e=document.querySelectorAll(".cart-item-js"),a=d(t);if(c){var n=t.container.find(".cart-item-js").length,r=H("#miniCartCustomHead"),s=Array.prototype.map.call(e,function(t){return t.offsetHeight});a=(i=Math.max.apply(Math,s))*Math.min(2,n),0<r.length&&(a+=r.outerHeight(!0)),t.container.find(".cart-item-container-js").css({height:a+"px"}),2<n?t.container.find(".cart-item-nav").hasClass("hide")&&t.container.find(".cart-item-nav").removeClass("hide"):t.container.find(".cart-item-nav").hasClass("hide")||(t.container.find(".cart-item-nav").addClass("hide"),t.container.find(".cart-item-slide-js").css("top",""))}else i<=a?(t.container.find(".cart-item-container-js").css("height",a+"px"),t.container.find(".cart-item-nav").hasClass("hide")||(t.container.find(".cart-item-nav").addClass("hide"),t.container.find(".cart-item-slide-js").css("top",""))):(t.container.find(".cart-item-container-js").css("height",a-70+"px"),t.container.find(".cart-item-nav").hasClass("hide")&&t.container.find(".cart-item-nav").removeClass("hide"))}return H(document).on("click",".mini-cart-action-remove-item-js, .mini-cart-action-add-to-cart-js",function(t){e(t)}),{renderMiniListItems:function(t,i,e,a){P(),n||(n=!0,H.ajax({url:t,dataType:"html",data:i}).done(function(t){c?_(t,e,a):_(t,e)}).always(function(t){T(),n=!1}))},initCarousel:r}});
//# sourceMappingURL=../../../maps/js/wcs/view/mini-list.hash-b84ea09cdcfbcdff4a16dcf9104470d9.js.map