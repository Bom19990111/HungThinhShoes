define(["jquery","pubsub","shared.main.screen","autocomplete.base","search-autosuggest-helpers"],function(r,e,s,t){"use strict";var i="searchAutoSuggest";function n(e,t){this.pluginID=i,this.element=e,this.$element=r(this.element),this.$searchForm=this.$element.is("form")?this.$element:this.$element.closest("form"),this.$searchInput=this.$element.find(".header-search-term-input-js, .topnav-search-input"),this.metadata=this.$element.data("options"),this.$searchContainer=null,this.$resultsContainer=null,this.options=t||{},this.searchAutoSuggestInit()}n.defaults=(n.prototype={defaults:{action:"after",topnav:".topnav-header",resultsContainer:".autosuggest-results-container",numsuggestions:7,numfeatured:3,highlightTerm:!1,hasTopSearches:!1,topSearchesText:"Top Searches :",searchAllText:"Search All :",displayKeywordsText:!0,quotesOnTextResults:!0,commaSeparated:!1,displayFeaturedResultsTextHeader:!0,hasFeaturedResults:!0,featuredResultsText:"Featured Results :",activeClass:"autosuggest-active",overlayClass:"autosuggest-overlay",topnavStickyClass:"topnav-minimized",priceDisplay:"offer-only",searchTerm:".search-term-js",closeBtn:".autosuggest-overlay-close"},searchAutoSuggestInit:function(){this.$window=r(window),this.$body=r("body"),this.$topnav=r(this.defaults.topnav),this.searchAutoSuggestEvents()},build:function(){var e=this;"html.search-autosuggest.expanded"===e.config.template&&(e.config.expandedView=!0,e.config.searchContainer="body"),"small"===s.size()&&e.config.expandedView&&e.enableResultsOverlay(),e.$searchContainer=r(e.config.searchContainer)||null,e.$searchContainer[e.config.action]('<div class="'+e.config.resultsContainer.replace(".","")+' hidden"></div>')},enableResultsOverlay:function(){this.$body.addClass(this.config.overlayClass)},disbleResultsOverlay:function(){this.$body.removeClass(this.config.overlayClass)},render:function(e){var s=this,t=s.formatData(e);if(t.config=s.config,t.suggestions||t.products){if(s.$resultsContainer=s.$resultsContainer||r(s.config.resultsContainer),s.$resultsContainer.html(s.compiledTemplate(t)),s.$resultsContainer.removeClass("hidden"),s.searchAutoSuggestWindowResizeEventToken=r.pubsub("subscribe","window.resize.breakpoint",function(e,t){s.handleWindowResize(t)}),s.config.expandedView&&(s.$body.addClass(s.config.activeClass),s.topnavStickyMinimizedEventToken=r.pubsub("subscribe","vfdp.topnav.sticky.minimized",function(){s.$resultsContainer.addClass(s.config.topnavStickyClass)}),s.topnavStickyMaximizedEventToken=r.pubsub("subscribe","vfdp.topnav.sticky.maximized",function(){s.$resultsContainer.removeClass(s.config.topnavStickyClass)})),!this.config.expandedView&&this.$topnav.hasClass("sticky")){var i=this.$window.height()-this.$resultsContainer.offset().top;this.$resultsContainer.css({"max-height":i,"overflow-y":"auto"})}}else s.clearDisplay()},formatData:function(e){var i=this;return{term:e.term,suggestions:e.response.suggestions&&e.response.suggestions.length?e.response.suggestions.map(function(e,t){return{keyword:e.keyword?e.keyword:e.dq?e.dq:""}}):[],products:e.response.products&&e.response.products.length?e.response.products.map(function(e,t){var s={label:e.label?e.label:e.title?e.title:"",category:e.category?e.category:"",price:e.sale_price?e.sale_price:e.price?e.price:"",list_price:e.list_price?e.list_price:e.price?e.price:"",image:e.image?e.image:e.thumb_image?e.thumb_image:"",url:e.url?e.url:""};return s.price=i.formatPrice(s.price),s.list_price=i.formatPrice(s.list_price),s}):[]}},formatPrice:function(e){if("number"!=typeof e)return e;var t=r('meta[name="locale"]').attr("content").replace("_","-").toLowerCase(),s=WCS_CONFIG.get("global::currencyCode"),i=WCS_CONFIG.get("global::currencySymbol");if(!s||!t||!i)return e;var n=Intl.NumberFormat.supportedLocalesOf(t);if(!n.length)return e;var a={style:"currency",currency:s,currencyDisplay:s===i?"code":"symbol"};return new Intl.NumberFormat(n[0],a).format(e)},searchAutoSuggestEvents:function(){var t=this;r(document).on("click",t.defaults.closeBtn,function(){t.clearDisplay(),t.$searchInput.val("").focus()}),document.addEventListener("click",function(e){if(r(e.srcElement).hasClass("s7button"))return!1;t.handleDocumentClick(e)})},handleDocumentClick:function(e){var t=r(e.target);if((!this.config.expandedView||"small"!==s.size())&&(0<t.closest(this.$resultsContainer).length||t.is(this.$resultsContainer)))return!1;this.clearDisplay()},clearDisplay:function(){var e=this;r(this.config.resultsContainer).addClass("hidden").empty(),this.$body.removeClass(this.config.activeClass),r.pubsub("unsubscribe",e.searchAutoSuggestWindowResizeEventToken),this.config.expandedView&&(r.pubsub("unsubscribe",e.topnavStickyMinimizedEventToken),r.pubsub("unsubscribe",e.topnavStickyMaximizedEventToken))},handleWindowResize:function(e){this.clearDisplay(),"small"===e.now&&this.config.expandedView?this.enableResultsOverlay():this.disbleResultsOverlay()}}).defaults,n.prototype=r.extend(!0,{},t.prototype,n.prototype),r.fn.searchAutoSuggest=function(t){return this.each(function(){var e=r(this).data(i);e||(e=new n(this,t).init(),r(this).data(i,e))})}});
//# sourceMappingURL=../../../maps/js/shared/search-autosuggest/search-autosuggest.hash-ae54a7bc7bb8b13376c963b783650378.js.map